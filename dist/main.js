(()=>{"use strict";const t=t=>{const e=[];return{isSunk:()=>{if(e.filter((t=>"X"===t)).length==t)return!0},hit:()=>e.push("X")}},e=document.querySelector(".game-info"),a=document.querySelector(".text-info");let r="hori";function o(t){for(let e=0;e<10;e++)for(let a=0;a<10;a++)if(""!=t[e][a]){const t=document.getElementById(`${e}${a}`);t.classList.add("grid-cell-with-ship"),t.classList.remove("shadow")}}function n(t){a.textContent=`Player, place your ${t}`}function s(t){let e=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());const r=document.getElementById(`${a}${e}`);""!=t.grid[a][e]&&"X"!=r.textContent?(t.receiveAttack(e,a),r.textContent="X"):""===t.grid[a][e]&&"O"!=r.textContent?r.textContent="O":s(t)}const l=()=>{const t=[["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""],["","","","","","","","","",""]];let e=0;const a=t=>""!=t;return{grid:t,placeShip:function(e,o,n,s){if("hori"==r){let r=[];for(let a=0;a<n;a++)r.push(t[o][e+a]);if(r.some(a))return;if(null!=t[o][e+(n-1)])for(let a=0;a<n;a++)t[o][e+a]=s}else if("vert"==r){let r=[];for(let a=0;a<n;a++)r.push(t[o+a][e]);if(r.some(a))return;if(null!=t[o+(n-1)][e])for(let a=0;a<n;a++)t[o+a][e]=s}},placeComputerShip:function e(r,o,n,s){const l=Math.floor(10*Math.random());if(l>4){let l=[];for(let e=0;e<n;e++)l.push(t[o][r+e]);if(l.some(a))e(Math.floor(10*Math.random()),Math.floor(10*Math.random()),n,s);else if(null!=t[o][r+(n-1)])for(let e=0;e<n;e++)t[o][r+e]=s}else if(l<=4&&null!=t[o+(n-1)]){let l=[];for(let e=0;e<n;e++)l.push(t[o+e][r]);if(l.some(a))e(Math.floor(10*Math.random()),Math.floor(10*Math.random()),n,s);else if(null!=t[o+(n-1)][r])for(let e=0;e<n;e++)t[o+e][r]=s}else e(Math.floor(10*Math.random()),Math.floor(10*Math.random()),n,s)},receiveAttack:function(a,r){t[r][a].hit(),t[r][a].isSunk()&&(e+=1),5==e&&alert("Game over")}}},d=document.getElementById("start"),i=document.querySelector(".game-info"),c=document.querySelector(".text-info"),p=l(),h=l(),f=t(5),u=t(5),m=t(4),I=t(4),M=t(3),g=t(3),y=t(3),x=t(3),v=t(2),C=t(2);let S=0,E=5;!function(){for(let t=0;t<10;t++)for(let e=0;e<10;e++){const a=document.getElementById("computer-grid"),r=document.createElement("div");r.classList.add("computer-grid-cell"),r.dataset.y=t,r.dataset.x=e,a.appendChild(r)}}(),function(){for(let t=0;t<10;t++)for(let e=0;e<10;e++){const a=document.getElementById("player-grid"),r=document.createElement("div");r.classList.add("player-grid-cell"),r.dataset.y=t,r.dataset.x=e,r.id=`${t}${e}`,a.appendChild(r)}}();const L=document.querySelectorAll(".player-grid-cell");d.addEventListener("click",(()=>{c.textContent="Player, place your carrier",d.style.display="none",function(){const t=document.createElement("button");t.textContent="Change orientation",e.appendChild(t),t.addEventListener("click",(()=>{r="vert"==r?"hori":"vert"}))}(),L.forEach((t=>{t.addEventListener("mouseenter",(()=>{if("vert"==r)for(let e=0;e<10*E;e+=10)null==L[parseInt(t.id)+10*(E-1)]?L[parseInt(t.id)+e].classList.add("shadow-wrong"):L[parseInt(t.id)+e].classList.add("shadow");else if(parseInt(t.dataset.x)+E>10)for(let e=0;e<10-parseInt(t.dataset.x);e++)L[parseInt(t.id)+e].classList.add("shadow-wrong");else for(let e=0;e<E;e++)L[parseInt(t.id)+e].classList.add("shadow")}))})),L.forEach((t=>{t.addEventListener("mouseleave",(()=>{if("vert"==r)for(let e=0;e<10*E;e+=10)null==L[parseInt(t.id)+10*(E-1)]?L[parseInt(t.id)+e].classList.remove("shadow-wrong"):L[parseInt(t.id)+e].classList.remove("shadow");else if(parseInt(t.dataset.x)+E>10)for(let e=0;e<10-parseInt(t.dataset.x);e++)L[parseInt(t.id)+e].classList.remove("shadow-wrong");else for(let e=0;e<E;e++)L[parseInt(t.id)+e].classList.remove("shadow")}))})),L.forEach((t=>{t.addEventListener("click",(()=>{switch(S){case 0:p.placeShip(parseInt(t.dataset.x),parseInt(t.dataset.y),5,f),o(p.grid),p.grid[parseInt(t.dataset.y)][parseInt(t.dataset.x)]==f&&(S+=1,E-=1,n("battleship"));break;case 1:p.placeShip(parseInt(t.dataset.x),parseInt(t.dataset.y),4,m),o(p.grid),p.grid[parseInt(t.dataset.y)][parseInt(t.dataset.x)]==m&&(S+=1,E-=1,n("cruiser"));break;case 2:p.placeShip(parseInt(t.dataset.x),parseInt(t.dataset.y),3,M),o(p.grid),p.grid[parseInt(t.dataset.y)][parseInt(t.dataset.x)]==M&&(S+=1,n("submarine"));break;case 3:p.placeShip(parseInt(t.dataset.x),parseInt(t.dataset.y),3,y),o(p.grid),p.grid[parseInt(t.dataset.y)][parseInt(t.dataset.x)]==y&&(S+=1,E-=1,n("destroyer"));break;case 4:p.placeShip(parseInt(t.dataset.x),parseInt(t.dataset.y),2,v),o(p.grid),p.grid[parseInt(t.dataset.y)][parseInt(t.dataset.x)]==v&&(S+=1,E=0,i.textContent="",e=h,a=p,document.querySelectorAll(".computer-grid-cell").forEach((t=>{t.addEventListener("click",(()=>{let r=parseInt(t.dataset.x),o=parseInt(t.dataset.y);""!=e.grid[o][r]&&"X"!=t.textContent?(e.receiveAttack(r,o),t.textContent="X",t.style.backgroundColor="darkgrey",s(a)):""===e.grid[o][r]&&"O"!=t.textContent?(t.textContent="O",s(a)):alert("This cell was already selected !")}))})));break;case 5:return}var e,a}))}))})),h.placeComputerShip(Math.floor(10*Math.random()),Math.floor(10*Math.random()),5,u),h.placeComputerShip(Math.floor(10*Math.random()),Math.floor(10*Math.random()),4,I),h.placeComputerShip(Math.floor(10*Math.random()),Math.floor(10*Math.random()),3,g),h.placeComputerShip(Math.floor(10*Math.random()),Math.floor(10*Math.random()),3,x),h.placeComputerShip(Math.floor(10*Math.random()),Math.floor(10*Math.random()),2,C)})();